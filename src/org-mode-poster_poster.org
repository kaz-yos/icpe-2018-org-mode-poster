#+startup: beamer
#+TITLE: Multinomial Extension of Propensity Score Trimming Methods: A Simulation Study
* Preamble                                                    :ignore:
** General comments                                           :ignore:
# ----------------------------------------------------------------------
# - Turn on synonyms by starting synosaurus-mode
# - Look up words using C-c sr
# - Turn on dictionary by starting flyspell-mode
# - Count words by section using org-wc-display
# ----------------------------------------------------------------------
** Specific comments for this manuscript                      :ignore:
# ----------------------------------------------------------------------
# This is a comment
# ----------------------------------------------------------------------
** org specific settings                                      :ignore:
# ----------------------------------------------------------------------
#+OPTIONS: email:nil toc:nil num:nil author:nil date:t tex:t title:nil
#+STARTUP: align fold
#+SEQ_TODO: TODO(t) | DONE(d)
#+TAGS: figure(f) check(c) noexport(n) ignore(i)
#+LANGUAGE: en
#+EXCLUDE_TAGS: noexport TODO
#+DATE: {{{time(%Y-%m-%d %H:%M)}}}
# ----------------------------------------------------------------------
** Latex header                                               :ignore:
# ----------------------------------------------------------------------
#+LATEX_CLASS:  mybeamerposter
#+LATEX_HEADER:  \setlength{\paperwidth}{36in}
#+LATEX_HEADER:  \setlength{\paperheight}{48in}
#+LATEX_HEADER: \setlength{\textwidth}{0.98\paperwidth}
#+LATEX_HEADER: \setlength{\textheight}{0.98\paperheight}
#+LATEX_HEADER: \graphicspath{{../output/figures/}{../lib/}}
#+LATEX_HEADER: \usepackage[export]{adjustbox}
#+LATEX_HEADER: \usepackage{graphicx,caption}
#+LATEX_HEADER: \usepackage{minted}
#+LATEX_HEADER: \usepackage{eurosym}
#+LATEX_HEADER: \usepackage{listings}
#+LATEX_HEADER: \usepackage{textcomp}
#+LATEX_HEADER: \usepackage{bibentry}
#+LATEX_HEADER: \newcommand\sumin{\sum_{i=1}^{n}}
#+LATEX_HEADER: \newcommand{\Xoi}[1]{#1(i)}
#+LATEX_HEADER: \newcommand{\frakPQ}[2]{\frac{\Xoi{#1}}{\Xoi{#2}}}
#+LATEX_HEADER: \newcommand{\DKLPQ}[3]{D_{\mathrm{KL}}(#1 #3 #2)}
#+LATEX_HEADER: \input{\string~/.emacs.d/misc/GrandMacros}
#+LATEX_HEADER: \date{}
# ----------------------------------------------------------------------
** Latex macros                                               :ignore:
# ----------------------------------------------------------------------
#+LATEX_HEADER: \newcommand{\auth}{Kazuki Yoshida, MD, MPH, MS}
#+LATEX_HEADER: \newcommand{\authemail}{kazukiyoshida@mail.harvard.edu}
#+LATEX_HEADER: \newcommand{\authtwitter}{@kaz\_yos}
#+LATEX_HEADER: \newcommand{\authgithub}{github.com/kaz-yos}
# ----------------------------------------------------------------------
** Authors and affiliations                                   :ignore:
# ----------------------------------------------------------------------
#+LATEX_HEADER: \author{
#+LATEX_HEADER: Kazuki Yoshida$^{1}$
#+LATEX_HEADER: Daniel H Solomon$^{2}$
#+LATEX_HEADER: Sebastien Haneuse$^{1}$
#+LATEX_HEADER: Seoyoung C Kim$^{2}$
#+LATEX_HEADER: Elisabetta Patorno$^{2}$
#+LATEX_HEADER: Sara K Tedeschi$^{2}$
#+LATEX_HEADER: Houchen Lyu$^{2}$
#+LATEX_HEADER: Sonia Hernandez-Diaz$^{1}$
#+LATEX_HEADER: Robert J Glynn$^{1}$
#+LATEX_HEADER: \\
#+LATEX_HEADER: \normalsize{$^{1}$ Harvard T.H. Chan School of Public Health, Boston, MA, USA; }
#+LATEX_HEADER: \normalsize{$^{2}$ Brigham and Women's Hospital, Boston, MA, USA}
#+LATEX_HEADER: }
# ----------------------------------------------------------------------
** Buffer-wide source code blocks                             :ignore:
# ----------------------------------------------------------------------
# Set elisp variables need for nice formatting We want no new lines in
# inline results and a paragraph size of 80 characters Important: this
# has to be evaluated witch C-c C-c in order to work in the current
# buffer
#+BEGIN_SRC emacs-lisp :exports none :results silent

  ; Nicer formatting for code
  (setq org-latex-listings t)
  (setq org-latex-listings 'minted)
  '(org-export-latex-listings-langs
      (quote ((emacs-lisp "Lisp")
              (lisp "Lisp")
              (clojure "Lisp")
              (c "C")
              (cc "C++")
              (fortran "fortran")
              (perl "Perl")
              (cperl "Perl")
              (python "Python")
              (ruby "Ruby")
              (html "HTML")
              (xml "XML")
              (tex "TeX")
              (latex "TeX")
              (shell-script "bash")
              (gnuplot "Gnuplot")
              (ocaml "Caml")
              (caml "Caml")
              (sql "SQL")
              (sqlite "sql")
              (R-mode "R"))))
  (setq org-latex-minted-options
     '(("linenos=true") ("bgcolor=lightgray")))
  ; set timestamp format
  ;(setq org-export-date-timestamp-format "%FT%T%z")
  (require 'org-wc)
  (flyspell-mode t)
  ;(evil-declare-change-repeat 'company-complete)
  (setq synosaurus-choose-method 'popup)
	(synosaurus-mode t)
	(auto-complete-mode t)
  ;(ac-config-default)
  ;(add-to-list 'ac-modes 'org-mode)
	(linum-mode t)
  (whitespace-mode t)
  (setq org-babel-inline-result-wrap "%s")
	(setq org-export-with-broken-links "mark")
  (setq fill-column 72)
  (setq whitespace-line-column 72)
	;(setq org-latex-caption-above '(table image))
	(setq org-latex-caption-above nil)
	(org-toggle-link-display)
	; don't remove logfiles at export
  (setq org-latex-remove-logfiles nil)

  ; Keybindings
  ; (global-set-key (kbd "<f7> c") "#+CAPTION: ")
  (defun setfillcolumn72 ()
	   (interactive)
     (setq fill-column 72)
		 )

  (defun setfillcolumn42 ()
	   (interactive)
     (setq fill-column 42)
   )
  (define-key org-mode-map (kbd "C-c c #") "#+CAPTION: ")
  (define-key org-mode-map (kbd "C-c l #") "#+LATEX_HEADER: ")
  (define-key org-mode-map (kbd "C-c f c 4 2") 'setfillcolumn42)
  (define-key org-mode-map (kbd "C-c f c 7 2") 'setfillcolumn72)

  (setq org-odt-category-map-alist
      '(("__Figure__" "*Figure*" "value" "Figure" org-odt--enumerable-image-p)))


	; let ess not ask for starting directory
  (setq ess-ask-for-ess-directory nil)

  ;(setq org-latex-pdf-process '("latexmk -pdflatex='xelatex
  ;-output-directory=../output/tex/ -interaction nonstopmode' -pdf
  ;-bibtex -f %f"))
  (setq org-latex-logfiles-extensions
      (quote("bcf" "blg" "fdb_latexmk" "fls"
      "figlist" "idx" "log" "nav" "out" "ptc"
      "run.xml" "snm" "toc" "vrb" "xdv")))

  ; deactivate link resolving
  (setq org-activate-links nil)


#+END_SRC
#
#
#
# ----------------------------------------------------------------------
** End preamble                                               :ignore:
# ----------------------------------------------------------------------

* The poster
:PROPERTIES:
:BEGIN:
:BEAMER_env: fullframe
:END:
** Code                                                       :ignore:
# Babel code can go here to populate the poster with dynamic output

** Left column                                        :BMCOL:
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_opt: [t]
:END:
*** Background                                                      :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- cite:crump_dealing_2009, cite:sturmer_treatment_2010 and cite:walker_tool_2013 have proposed PS trimming methods for binary exposures.


- In particular, cite:sturmer_treatment_2010 demonstrated benefits of PS trimming in reducing unmeasured confounding in the presence of unmeasured confounders that were more prevalent in the tails of the PS distribution among those who received treatment on contrary to the prediction based on measured confounders.


- We extended binary PS trimming rules to the general multinomial settings. We illustrated and examined their characteristics in the visually-tractable 3-group setting.


*** Notations                                                       :B_block:
\small
 | Notation                                                                      | Explanation                            |
 |-------------------------------------------------------------------------------+----------------------------------------|
 | $i \in \left\{ 1,...,n \right\}$                                              | index for an individual                |
 | $I = \left\{ 1,...,n \right\}$                                                | index set for entire sample            |
 | $A_{i} \in \left\{ 0,1 \right\}$                                              | treatment variable                     |
 | $\bX_{i}$                                                                     | covariates                             |
 | $e_{i} = P[A_{i}=1 \vert \bX_{i}]$                                            | propensity score                       |
 | $p = P[A_{i}=1]$                                                              | treatment prevalence                   |
 | $\pi_{i} = \frac{\frac{e_{i}}{p}}{\frac{1 - e_{i}}{1 - p} + \frac{e_{i}}{p}}$ | preference score                       |
 | $F^{-1}_{e_{i}\vert A_{i}}(x \vert a)$                                        | treatment-specific quantile of $e_{i}$ |
 |-------------------------------------------------------------------------------+----------------------------------------|
 | $A_{i} \in \left\{ 0,...,J \right\}$                                          | multinomial treatment variable         |
 | $e_{ji} = P[A_{i}=j \vert \bX_{i}]$                                           | propensity score for treatment $j$     |
 | $p_{j} = P[A_{i}=j]$                                                          | treatment $j$ prevalence               |
 | $\pi_{ji} = \frac{\frac{e_{ji}}{p_{j}}}{\sum^{J}_{k=0} \frac{e_{ki}}{p_{k}}}$ | preference score for treatment $j$     |
 | $\alpha_{J,c},\alpha_{J,s},\alpha_{J,w}$                                      | trimming thresholds for $J+1$ groups   |


*** Definitions                                                     :B_block:

\small
 | Method           | Existing binary definition                                                                                                                |
 |------------------+-------------------------------------------------------------------------------------------------------------------------------------------|
 | Crump            | $I_{c} = \left\{ i \in I: e_{i} \in [0.1,0.9] \right\}$                                                                                   |
 | \text{St\"urmer} | $I_{s} = \left\{ i \in I: e_{i} \in \left[F^{-1}_{e_{i}\vert A_{i}}(0.05\vert 1), F^{-1}_{e_{i}\vert A_{i}}(0.95\vert 0)\right] \right\}$ |
 | Walker           | $I_{w} = \left\{ i \in I: \pi_{i} \in [0.3, 0.7] \right\}$                                                                                |

 | Method           | Proposed multinomial definition                                                                                                                             |
 |------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------|
 | Crump            | $I_{J,c} = \left\{ i \in I: e_{ji} \in [\alpha_{J,c},1.0] ~\forall~ j \in \left\{ 0,...,J \right\} \right\}$                                                |
 | \text{St\"urmer} | $I_{J,s} = \left\{ i \in I: e_{ji} \in \left[F^{-1}_{e_{ji}\vert A_{i}}(\alpha_{J,s}\vert j), 1.0\right] ~\forall~ j \in \left\{ 0,...,J \right\} \right\}$ |
 | Walker           | $I_{J,w} = \left\{ i \in I: \pi_{ji} \in [\alpha_{J,w}, 1.0] ~\forall~ j \in \left\{ 0,...,J \right\} \right\}$                                             |

*** Interpretation                                                  :B_block:

Multinomial Crump trimming retains subjects who have all PSs above the threshold αJ,c. Multinomial Stürmer trimming is asymmetric in that the lower threshold for each PS is different unlike multinomial Crump trimming. The lower threshold is the 100αJ,c percentile of each PS in the corresponding treatment group. Multinomial Walker trimming is similar to multinomial Crump trimming except the use of a preference score in place of PS. We only define the lower threshold. Trimming the upper tail is implicit because individuals who have a very high PS for one treatment have very low PSs for the other treatments. These definitions reduce to the original definitions when there are only two groups.


** Right column                                       :BMCOL:
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_opt: [t]
:END:
*** Empirical data                                                  :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
#+ATTR_LATEX: :height 0.8\textheight :width 0.8\textwidth :options page=1,keepaspectratio :center t
[[../../../_trimming_stats/shiny_trim_empirical_ternary/out/three_datasets.png]]


*** Conclusions                                                     :B_block:
:PROPERTIES:
:BEAMER_env: block
:END:
- We developed multinomial generalization of existing PS trimming rules.
- Maybe useful as sensitivity analysis.


*** Bibliography                                                    :B_block:
   :PROPERTIES:
   :BEAMER_opt: allowframebreaks,label=,t
   :END:
\tiny
# To remove "References" section header
\renewcommand{\section}[2]{}
# Following lines must be left-aligned without preceding spaces.
bibliographystyle:apalike
bibliography:~/.emacs.d/misc/zotero.bib
